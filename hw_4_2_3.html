<meta charset="utf-8">
<script>

/* Продолжить работу с интернет-магазином:
В прошлом домашнем задании вы реализовали корзину на базе массивов. Какими объектами можно заменить их элементы?
Реализуйте такие объекты. Перенести функционал подсчета корзины на объектно-ориентированную базу. */


function orderStrSum () {                                                       // функция подсчета итога по строке корзины (сущность "order")
		if (this.status === 'confirmed') {                                      // итог рассчитывается только, если заказ товара подтвержден (статус 'confirmed')
			this.orderSummary = this.item.price * this.quantity
		}
}


let item1 = {
	name: 'Футболка',
	size: 'M',
	colour: 'красный',
	price: 1000,
	gender: 'Муж',
	age: 'Взрослые',
	section: 'Одежда',
	type: 'Футболки, майки',
	brand: 'Levis'

};

let item2 = {
	name: 'Комплект',
	size: 'S',
	colour: 'бежевый',
	price: 1500,
	gender: 'Жен',
	age: 'Взрослые',
	section: 'Одежда',
	type: 'Одежда для дома',
	brand: 'Pelican'
};

let item3 = {
	name: 'product3',
	size: '42',
	colour: 'black',
	price: 8200,
	age: 'Взрослые',
	section: 'Обувь',
	type: 'Туфли',
	brand: 'Ecco',
	material: 'кожа натуральная'	
};

let item4 = {
	name: 'Носки 2 пары, комплект',
	size: '25 - 27',
	colour: 'синий',
	price: 1300,
	age: 'Взрослые',
	section: 'Одежда',
	type: 'Аксессуары',
	brand: 'Wilson'
};

let orderStr1 = {                                                                    // объект = строка заказа
	item: item1,
	quantity: 3,
	status: 'started',                                                               // 'started' - default статус строки заказа, для включения в итог статус должен быть 'confirmed' 
	orderSummary: 0,                                                                 // итог по строке заказа
	confirmation: function () {
		this.status = 'confirmed'
	}
	};

let orderStr2 = {
	item: item2,
	quantity: 2,
	status: 'started',
	orderSummary: 0,
	confirmation: orderStr1.confirmation
};

let orderStr3 = {
	item: item3,
	quantity: 1,
	status: 'started',
	orderSummary: 0,
	confirmation: orderStr1.confirmation
};

let orderStr4 = {
	item: item4,
	quantity: 5,
	status: 'started',
	orderSummary: 0,
	confirmation: orderStr1.confirmation
};


let basket = {                                                                             // объект = итоговый заказ
	items: [],
	basketSum: 0,
	paidSum: 0,
	status: 'started',
	confirmation: orderStr1.confirmation,
	payment: function () {                                                                 // функция меняет статус и свойство заказа "оплаченная сумма"
		this.status = 'paid',
		this.paidSum = this.basketSum
	},
	ready: function () {
		this.status = 'ready'
	},
	shipping: function () {
		this.status = 'shipped'
	},	
	delivery: function () {
		this.status = 'delivered'
	},	
	countBasketSum: function () {
		this.basketSum = 0;
		for (idx in this.items) {
			this.basketSum += this.items[idx].orderSummary
		}
	}
};


orderStr1.confirmation ();                                                                  // по 3 строкам из 4 подтверждаю заказ товара 
orderStr2.confirmation ();
orderStr3.confirmation ();                                   

orderStr1.orderStrSum = orderStrSum;                                                        // добавляю в объект "строка заказа" функцию расчета итога
orderStr2.orderStrSum = orderStrSum;
orderStr3.orderStrSum = orderStrSum;
orderStr4.orderStrSum = orderStrSum;

orderStr1.orderStrSum ();                                                                    // рассчитываю итоги по каждой строке заказа (по 4-ой строке он равен нулю, т.к. статус 'started') 
orderStr2.orderStrSum ();
orderStr3.orderStrSum ();
orderStr4.orderStrSum ();

basket.items.push (orderStr1);                                                               // в корзину добавляю все 4 строки
basket.items.push (orderStr2);
basket.items.push (orderStr3);
basket.items.push (orderStr4);

basket.countBasketSum ();                                                                    // рассчитываю предварительный итог (без 4 строки, она не подтверждена)
alert (`Итоговая сумма подтвержденных к заказу товаров в корзине: ${basket.basketSum}`);


orderStr4.confirmation ();                                                                    // подтверждаю заказ по 4ой строке
orderStr4.orderStrSum ();

basket.countBasketSum ();                                                                     // рассчитываю предварительный итог (все строки подтверждены)
alert (`Итоговая сумма подтвержденных к заказу товаров в корзине: ${basket.basketSum}`);

alert (`Текущий статус заказа: ${basket.status}\nОплачено по заказу: ${basket.paidSum}`);

basket.payment ();                                                                           // меняю статусы заказа целиком от открытия до доставки
alert (`Текущий статус заказа: ${basket.status}\nОплачено по заказу: ${basket.paidSum}`);

basket.ready ();
alert (`Текущий статус заказа: ${basket.status}\nОплачено по заказу: ${basket.paidSum}`);

basket.shipping ();
alert (`Текущий статус заказа: ${basket.status}\nОплачено по заказу: ${basket.paidSum}`);

basket.delivery ();
alert (`Текущий статус заказа: ${basket.status}\nОплачено по заказу: ${basket.paidSum}`);

</script>
